/*************************************************************************
* ADOBE CONFIDENTIAL
* ___________________
*
*  Copyright 2015 Adobe Systems Incorporated
*  All Rights Reserved.
*
* NOTICE:  All information contained herein is, and remains
* the property of Adobe Systems Incorporated and its suppliers,
* if any.  The intellectual and technical concepts contained
* herein are proprietary to Adobe Systems Incorporated and its
* suppliers and are protected by all applicable intellectual property laws,
* including trade secret and or copyright laws.
* Dissemination of this information or reproduction of this material
* is strictly forbidden unless prior written permission is obtained
* from Adobe Systems Incorporated.
**************************************************************************/
function dependOn(){"use strict";return[require("common"),require("util"),require("analytics")]}var def;require=function(e){"use strict";return e},def=window.define?window.define:function(e,t){"use strict";return t.apply(null,[{ajax:$.ajax.bind($)}])};var exports=acom_analytics={};def(dependOn(),(function(e,t,n){"use strict";var r=null,o=!1,i=chrome.extension.getURL("viewer.html"),s=chrome.extension.getURL("/"),a=!1;function c(n){!function(){try{let n=0!=communicate.version&&1!=communicate.version,r=!(!n||communicate.version===SETTINGS.READER_VER||communicate.version===SETTINGS.ERP_READER_VER);localStorage.setItem("locale",t.getFrictionlessLocale(chrome.i18n.getMessage("@@ui_locale"))),localStorage.setItem("cdnUrl",e.getAcrobatViewerUri()),localStorage.setItem("isDeskTop",n),localStorage.setItem("env",e.getEnv()),localStorage.setItem("viewerImsClientId",e.getViewerIMSClientId()),localStorage.setItem("imsURL",e.getIMSurl()),localStorage.setItem("isAcrobat",r)}catch(e){}}();let r=i;if(r+="?pdfurl="+encodeURIComponent(n.url),void 0!==n.responseHeaders){const e=f(n.responseHeaders,"content-length");e&&(r+="&clen="+e.value);const t=f(n.responseHeaders,"accept-ranges");t&&t.value&&"bytes"===t.value.toLowerCase()&&(r+="&chunk=true");const o=f(n.responseHeaders,"content-disposition");if(o&&o.value&&/\.pdf(["']|$)/i.test(o.value)){const e=/filename[^;=\n\*]?=((['"]).*?\2|[^;\n]*)/.exec(o.value);if(null!=e&&e.length>1){r+="&pdffilename="+e[1].replace(/['"]/g,"")}}}return function(e){const t=new URL(e.url),n=new URLSearchParams(t.search);let r=!1;const o=e.initiator;o&&["https://classroom.google.com","https://mail.google.com","https://drive.google.com"].includes(o)&&n.forEach((e,t)=>{t.startsWith("print")&&"true"===e&&(r=!0)});return r}(n)&&(r+="&googlePrint=true"),r}function u(e){if(!SETTINGS.IS_READER&&SETTINGS.USE_ACROBAT&&0!=communicate.version&&(1!=communicate.version||0!=t.getNMHConnectionStatus())&&e.url){const t=new URL(e.url);chrome.runtime.id===t.host?(chrome.contextMenus.update("convertPageContextMenu",{visible:!1}),chrome.contextMenus.update("appendPageContextMenu",{visible:!1})):(chrome.contextMenus.update("convertPageContextMenu",{visible:!0}),chrome.contextMenus.update("appendPageContextMenu",{visible:!0}))}}function l(e){const n=new Date;n.setMinutes(n.getMinutes()+SETTINGS.VIEWER_RECHECK_CDN_ACCESS_DELAY_MINS),t.setCookie("netAccAdT",n.getTime()),t.setCookie("netAcc",e)}chrome.extension.isAllowedFileSchemeAccess((function(e){a=e})),chrome.tabs.onActivated.addListener((function(e){chrome.tabs.get(e.tabId,(function(e){chrome.runtime.lastError||u(e)}))}));function d(){try{return"true"===t.getCookie("pdfViewer")}catch(e){return!1}}function f(e,t){for(var n=0;n<e.length;++n){var r=e[n];if(r.name.toLowerCase()===t)return r}}function m(e){if(void 0!==e.responseHeaders){const t=f(e.responseHeaders,"content-type"),r=f(e.responseHeaders,"content-disposition");if(t){const e=t.value.toLowerCase().split(";",1)[0].trim();if(r&&/^\s*attachment[;]?/i.test(r.value))return"application/pdf"===e||"application/octet-stream"===e?n.event(n.e.VIEWER_PDF_ATTACHMENT_IGNORED):n.event(n.e.VIEWER_ATTACHMENT_IGNORED),!1;if("application/pdf"===e)return o||n.event(n.e.VIEWER_PDF_PROCESS_PDF),!0;if("application/octet-stream"===e&&r&&/\.pdf(["']|$)/i.test(r.value))return n.event(n.e.VIEWER_PDF_PROCESS_OS_CD),!0}}else if("file"==(t=e.url,r=t.indexOf("/"),t.substr(0,r-1))&&"PDF"==function(e){if(e)try{var t=new URL(e).pathname;return t.substr(t.lastIndexOf(".")+1).toUpperCase()}catch(e){return""}return""}(e.url))return!0;var t,r;return!1}function p(e,t){e&&t&&chrome.tabs.update(e,{url:t})}function E(e,i){if("main_frame"===e.type){if(!function(){if(!window.navigator.onLine)return!1;const e=new Date,n=t.getCookie("netAcc"),r=t.getCookie("netAccAdT");return!(r&&r>e.getTime())||"true"===n}()||!function(e){if("GET"!==e.method||!SETTINGS.VIEWER_ENABLED||!d())return!1;var r=e.url;let i="reloadurl-"+e.tabId;const s=t.getCookie(i);if(s&&s===r){try{localStorage.removeItem(i)}catch(e){}return!1}if(!(e=>{if(!e||null===e||"undefined"===e)return!1;return!![/^http\:\/\/[^/]/,/^https\:\/\/[^/]/,/^file?:/].find(t=>t.test(e))&&![/^chrome\:\/\//,/^chrome\-extension\:\/\//,/^https:\/\/([a-zA-Z\d-]+\.){0,}officeapps.live.com/,/^https\:\/\/*.*\/(saml|login)/,/^https:\/\/sharedcloud.([a-zA-Z\d-]+)+.(s3|s3-accelerate).amazonaws.com/,/^https\:\/\/*.*.(login|auth|okta|saml).*\/S*|(login|auth|okta|saml|IWA|owa)\//,/^https\:\/\/www.google.com\/search\?q/,/^https\:\/\/www.citibank.*/,/^https:\/\/[^/]*\.*\/([$-/:-?{-~!"^_`\[\]A-Za-z0-9]*)view-sdk/].find(t=>t.test(e))})(r))return!1;const a=m(e);return o?(a&&n.event(n.e.VIEWER_FALLBACK_TO_NATIVE_INCOGNITO),!1):a}(e))return;return i&&!a?void n.event(n.e.VIEWER_PDF_LOCAL_FILE_IGNORED):(i?n.event(n.e.VIEWER_PDF_LOCAL_FILE):n.event(n.e.VIEWER_PDF_DETECT_HEADERS),r=e.url,{redirectUrl:c(e)})}var s;"sub_frame"===e.type&&(s=e.url,/^https:\/\/[^/]*(acrobat|adobe)\.com\/proxy\/chrome-viewer/.test(s))&&(200!==e.statusCode?403===e.statusCode?(t.setCookie("pdfViewer",!1),n.event(n.e.VIEWER_FALLBACK_TO_NATIVE_CDN_FORBIDDEN),p(e.tabId,r)):(l(!1),n.event(n.e.VIEWER_FALLBACK_TO_NATIVE_CDN_OFFLINE),p(e.tabId,r)):l(!0))}chrome.tabs.onUpdated.addListener((e,n,r)=>{if(o=r.incognito,"complete"===r.status&&u(r),"loading"===n.status)try{new URL(r.url);!t.isViewerURL(r.url)||d()&&!o||p(e,function(e,t){t||(t=window.location.href);try{const n=new URL(t);return new URLSearchParams(n.search).get(e)}catch(e){return}}("pdfurl",r.url))}catch(e){}}),chrome.webRequest.onHeadersReceived.addListener((function(e){return E(e,!1)}),{urls:["http://*/*","https://*/*"],types:["main_frame","sub_frame"]},["responseHeaders","blocking"]),chrome.webRequest.onBeforeRequest.addListener((function(e){return E(e,!0)}),{urls:["file://*/*.pdf","file://*/*.PDF"],types:["main_frame","sub_frame"]},["blocking"]),chrome.webRequest.onBeforeRequest.addListener((function(e){var n=t.parseExtensionURL(e.url);if(n){n=i+"?pdfurl="+n;var r=e.url.indexOf("#");return r>0&&(n+=e.url.slice(r)),{redirectUrl:n}}}),{types:["main_frame","sub_frame"],urls:["http","https","ftp","file","blob","data","filesystem","drive"].map((function(e){return s+e+"*"}))},["blocking"])}));